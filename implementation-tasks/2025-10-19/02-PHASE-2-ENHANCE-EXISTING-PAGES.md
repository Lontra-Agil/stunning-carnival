# Phase 2: Enhance Existing Pages

**Duration**: 1 day
**Priority**: HIGH
**Dependencies**: Phase 1 (SEO Infrastructure)

---

## Overview

This phase enhances existing pages with comprehensive metadata and JSON-LD schemas. We'll update:
- Root layout with global metadata
- Landing page with Organization, WebSite, and Breadcrumb schemas
- Auth pages with proper metadata

---

## Task 1: Update Root Layout

### File: `/src/app/layout.tsx`

**Current state**:
```typescript
export const metadata: Metadata = {
  title: "Lontra Agíl",
  description: "Generated by create-t3-app",
  icons: [{ rel: "icon", url: "/lontra-icon.svg" }],
};
```

**Enhanced implementation**:

```typescript
import { GeistSans } from "geist/font/sans";
import type { Metadata } from "next";

import "@/styles/globals.css";
import "@/styles/gray-color.css";

import { ClerkProvider } from "@clerk/nextjs";
import { Providers } from "@/components/providers/providers";
import { TRPCReactProvider } from "@/trpc/react";
import { generateRootMetadata } from "@/lib/seo/metadata-config";

// Generate root metadata with bilingual support
export const metadata: Metadata = generateRootMetadata("pt-br");

export default function RootLayout({
  children,
}: Readonly<{ children: React.ReactNode }>) {
  return (
    <ClerkProvider>
      <html lang="pt-BR" className={GeistSans.className}>
        <body>
          <Providers>
            <TRPCReactProvider>{children}</TRPCReactProvider>
          </Providers>
        </body>
      </html>
    </ClerkProvider>
  );
}
```

**Key changes**:
- ✅ Import `generateRootMetadata` from metadata-config
- ✅ Replace static metadata with generated metadata
- ✅ Set proper `lang` attribute on `<html>` tag
- ✅ Comprehensive metadata includes:
  - Title template: `%s | Lontra Ágil`
  - Description, keywords
  - Open Graph tags
  - Twitter Cards
  - Icons (favicon, apple-touch-icon)
  - Robots directives
  - Google Search Console verification

**Testing**:
1. Run `npm run build`
2. Check that metadata appears in `<head>` of rendered pages
3. Validate Open Graph with: https://developers.facebook.com/tools/debug/

---

## Task 2: Enhance Landing Page

### File: `/src/app/page.tsx`

**Current state**: Basic page component without metadata

**Enhanced implementation**:

```typescript
import { CheckSessionAndRedirect } from "@/components/check-session-and-redirect/check-session-and-redirect";
import { LandingPageCTA } from "@/components/landing-page-components/landing-page-cta";
import { LandingPageFeatures } from "@/components/landing-page-components/landing-page-features";
import { LandingPageFooter } from "@/components/landing-page-components/landing-page-footer";
import { LandingPageHeader } from "@/components/landing-page-components/landing-page-header";
import { LandingPageHero } from "@/components/landing-page-components/landing-page-hero";
import { LandingPageHowItWorks } from "@/components/landing-page-components/landing-page-how-it-works";
import { LandingPageFAQ } from "@/components/landing-page-components/lannding-page-faq";
import { LandingPageStats } from "@/components/landing-page-components/landing-page-stats";
import { JsonLdScript } from "@/lib/seo/json-ld-script";
import {
  generateOrganizationSchema,
  generateWebSiteSchema,
  generateBreadcrumbSchema,
  generateHowToSchema,
} from "@/lib/seo/json-ld-schemas";
import { generateMetadata as generatePageMetadata } from "@/lib/seo/metadata-config";
import type { Metadata } from "next";

// ============================================================================
// METADATA
// ============================================================================

export const metadata: Metadata = generatePageMetadata({
  title: {
    en: "Lontra Ágil - Connect with Top Developers and Contractors",
    "pt-br": "Lontra Ágil - Conecte-se com Desenvolvedores e Contratantes",
  },
  description: {
    en: "Platform connecting developers and contractors for agile project collaboration. Find talent, post projects, and build amazing software together.",
    "pt-br": "Plataforma que conecta desenvolvedores e contratantes para colaboração ágil em projetos. Encontre talentos, publique projetos e construa software incrível juntos.",
  },
  keywords: {
    en: [
      "developers marketplace",
      "contractor platform",
      "freelance developers",
      "agile development",
      "project collaboration",
      "hire developers",
      "find contracts",
      "software development",
    ],
    "pt-br": [
      "marketplace desenvolvedores",
      "plataforma contratantes",
      "desenvolvedores freelance",
      "desenvolvimento ágil",
      "colaboração projetos",
      "contratar desenvolvedores",
      "encontrar contratos",
      "desenvolvimento software",
    ],
  },
  path: "/",
  locale: "pt-br",
});

// ============================================================================
// ISR CONFIGURATION
// ============================================================================

// Revalidate homepage every 24 hours
export const revalidate = 86400;

// ============================================================================
// COMPONENT
// ============================================================================

export default function Home() {
  // Generate JSON-LD schemas
  const organizationSchema = generateOrganizationSchema("pt-br");
  const webSiteSchema = generateWebSiteSchema();
  const breadcrumbSchema = generateBreadcrumbSchema([
    {
      name: "Início",
      url: "https://lontraagil.com",
      position: 1,
    },
  ]);

  // HowTo schema for "Como Funciona" section
  const howToSchema = generateHowToSchema({
    name: "Como usar Lontra Ágil",
    description: "Aprenda a conectar desenvolvedores e contratantes na plataforma",
    totalTime: "PT15M",
    steps: [
      {
        name: "Cadastre-se",
        text: "Crie sua conta como desenvolvedor ou contratante",
        url: "https://lontraagil.com/app/auth/developer",
      },
      {
        name: "Complete seu perfil",
        text: "Adicione suas habilidades, experiência e portfólio",
      },
      {
        name: "Conecte-se",
        text: "Encontre projetos ou contrate desenvolvedores qualificados",
      },
      {
        name: "Colabore",
        text: "Trabalhe de forma ágil e construa software incrível",
      },
    ],
  });

  return (
    <>
      {/* JSON-LD Structured Data */}
      <JsonLdScript data={organizationSchema} />
      <JsonLdScript data={webSiteSchema} />
      <JsonLdScript data={breadcrumbSchema} />
      <JsonLdScript data={howToSchema} />

      {/* Page Content */}
      <CheckSessionAndRedirect />
      <div className="min-h-screen bg-background" data-theme="landing-page">
        <LandingPageHeader />
        <main>
          <LandingPageHero />
          <LandingPageStats />
          <LandingPageFeatures />
          <LandingPageHowItWorks />
          <LandingPageFAQ />
          <LandingPageCTA />
        </main>
        <LandingPageFooter />
      </div>
    </>
  );
}
```

**Key changes**:
- ✅ Add page-specific metadata with bilingual support
- ✅ Add ISR revalidation (24 hours)
- ✅ Inject Organization schema (brand identity)
- ✅ Inject WebSite schema (enables sitelinks search box)
- ✅ Inject BreadcrumbList schema (navigation hierarchy)
- ✅ Inject HowTo schema (for "How It Works" section)
- ✅ Wrap content in semantic `<main>` tag

**Testing**:
1. Build and run: `npm run build && npm start`
2. View page source: View > Developer > View Source
3. Verify JSON-LD scripts are present in `<head>`
4. Test with Google Rich Results Test: https://search.google.com/test/rich-results
5. Validate schemas: https://validator.schema.org/

---

## Task 3: Enhance Developer Auth Page

### File: `/src/app/app/auth/developer/page.tsx`

**Current state**: Basic auth page without metadata

**Enhanced implementation**:

```typescript
import Image from "next/image";
import { SignedOut } from "@clerk/nextjs";
import { AuthDeveloperForm } from "@/components/auth-developer-form/auth-developer-form";
import { JsonLdScript } from "@/lib/seo/json-ld-script";
import {
  generateBreadcrumbSchema,
  generateWebPageSchema,
} from "@/lib/seo/json-ld-schemas";
import { generateMetadata as generatePageMetadata } from "@/lib/seo/metadata-config";
import type { Metadata } from "next";

// ============================================================================
// METADATA
// ============================================================================

export const metadata: Metadata = generatePageMetadata({
  title: {
    en: "Developer Sign Up - Lontra Ágil",
    "pt-br": "Cadastro Desenvolvedor - Lontra Ágil",
  },
  description: {
    en: "Join Lontra Ágil as a developer. Find exciting projects, collaborate with clients, and grow your freelance career.",
    "pt-br": "Junte-se à Lontra Ágil como desenvolvedor. Encontre projetos emocionantes, colabore com clientes e impulsione sua carreira freelance.",
  },
  keywords: {
    en: [
      "developer signup",
      "freelance developer",
      "developer registration",
      "join as developer",
      "developer platform",
    ],
    "pt-br": [
      "cadastro desenvolvedor",
      "desenvolvedor freelance",
      "registro desenvolvedor",
      "plataforma desenvolvedor",
    ],
  },
  path: "/app/auth/developer",
  locale: "pt-br",
  noIndex: true, // Don't index auth pages
});

// ============================================================================
// COMPONENT
// ============================================================================

export default function AuthDeveloperPage() {
  const breadcrumbSchema = generateBreadcrumbSchema([
    {
      name: "Início",
      url: "https://lontraagil.com",
      position: 1,
    },
    {
      name: "Cadastro Desenvolvedor",
      url: "https://lontraagil.com/app/auth/developer",
      position: 2,
    },
  ]);

  const webPageSchema = generateWebPageSchema({
    name: "Cadastro Desenvolvedor - Lontra Ágil",
    description: "Página de cadastro para desenvolvedores na plataforma Lontra Ágil",
    url: "https://lontraagil.com/app/auth/developer",
    locale: "pt-br",
  });

  return (
    <>
      {/* JSON-LD Structured Data */}
      <JsonLdScript data={breadcrumbSchema} />
      <JsonLdScript data={webPageSchema} />

      {/* Page Content */}
      <SignedOut>
        <main className="flex h-screen flex-col items-center justify-center gap-8 px-4">
          <Image
            src="/lontra-icon.svg"
            alt="Lontra Ágil"
            width={80}
            height={80}
            priority
          />
          <AuthDeveloperForm />
        </main>
      </SignedOut>
    </>
  );
}
```

**Key changes**:
- ✅ Add page-specific metadata
- ✅ Set `noIndex: true` (auth pages shouldn't be indexed)
- ✅ Add BreadcrumbList schema
- ✅ Add WebPage schema
- ✅ Wrap content in semantic `<main>` tag
- ✅ Add `priority` prop to Image for LCP optimization

---

## Task 4: Enhance Contractor Auth Page

### File: `/src/app/app/auth/contractor/page.tsx`

**Enhanced implementation**:

```typescript
import Image from "next/image";
import { SignedOut } from "@clerk/nextjs";
import { AuthContractorForm } from "@/components/auth-contractor-form/auth-contractor-form";
import { JsonLdScript } from "@/lib/seo/json-ld-script";
import {
  generateBreadcrumbSchema,
  generateWebPageSchema,
} from "@/lib/seo/json-ld-schemas";
import { generateMetadata as generatePageMetadata } from "@/lib/seo/metadata-config";
import type { Metadata } from "next";

// ============================================================================
// METADATA
// ============================================================================

export const metadata: Metadata = generatePageMetadata({
  title: {
    en: "Contractor Sign Up - Lontra Ágil",
    "pt-br": "Cadastro Contratante - Lontra Ágil",
  },
  description: {
    en: "Join Lontra Ágil as a contractor. Post projects, find talented developers, and build your dream software.",
    "pt-br": "Junte-se à Lontra Ágil como contratante. Publique projetos, encontre desenvolvedores talentosos e construa o software dos seus sonhos.",
  },
  keywords: {
    en: [
      "contractor signup",
      "hire developers",
      "contractor registration",
      "post projects",
      "find developers",
    ],
    "pt-br": [
      "cadastro contratante",
      "contratar desenvolvedores",
      "registro contratante",
      "publicar projetos",
      "encontrar desenvolvedores",
    ],
  },
  path: "/app/auth/contractor",
  locale: "pt-br",
  noIndex: true, // Don't index auth pages
});

// ============================================================================
// COMPONENT
// ============================================================================

export default function AuthContractorPage() {
  const breadcrumbSchema = generateBreadcrumbSchema([
    {
      name: "Início",
      url: "https://lontraagil.com",
      position: 1,
    },
    {
      name: "Cadastro Contratante",
      url: "https://lontraagil.com/app/auth/contractor",
      position: 2,
    },
  ]);

  const webPageSchema = generateWebPageSchema({
    name: "Cadastro Contratante - Lontra Ágil",
    description: "Página de cadastro para contratantes na plataforma Lontra Ágil",
    url: "https://lontraagil.com/app/auth/contractor",
    locale: "pt-br",
  });

  return (
    <>
      {/* JSON-LD Structured Data */}
      <JsonLdScript data={breadcrumbSchema} />
      <JsonLdScript data={webPageSchema} />

      {/* Page Content */}
      <SignedOut>
        <main className="flex h-screen flex-col items-center justify-center gap-8 px-4">
          <Image
            src="/lontra-icon.svg"
            alt="Lontra Ágil"
            width={80}
            height={80}
            priority
          />
          <AuthContractorForm />
        </main>
      </SignedOut>
    </>
  );
}
```

**Key changes**: Same as developer auth page, but with contractor-specific content.

---

## Task 5: Create OG Image (Optional but Recommended)

### File: `/public/og-image.png`

**Specifications**:
- Dimensions: 1200x630px (Facebook/LinkedIn standard)
- Format: PNG or JPG
- Max size: < 300KB
- Content:
  - Lontra Ágil logo
  - Tagline: "Conecte-se com Desenvolvedores e Contratantes"
  - Clean, professional design
  - High contrast for readability

**Tools for creation**:
- Figma (recommended)
- Canva
- Adobe Photoshop
- Next.js OG Image Generation (advanced)

**Alternative**: Use Next.js dynamic OG image generation

Create `/src/app/opengraph-image.tsx`:

```typescript
import { ImageResponse } from "next/og";

export const runtime = "edge";

export const alt = "Lontra Ágil - Conecte-se com Desenvolvedores e Contratantes";
export const size = {
  width: 1200,
  height: 630,
};
export const contentType = "image/png";

export default async function Image() {
  return new ImageResponse(
    (
      <div
        style={{
          fontSize: 128,
          background: "linear-gradient(to bottom right, #1e40af, #06b6d4)",
          width: "100%",
          height: "100%",
          display: "flex",
          flexDirection: "column",
          alignItems: "center",
          justifyContent: "center",
          color: "white",
          fontFamily: "sans-serif",
        }}
      >
        <div style={{ fontSize: 80, fontWeight: "bold" }}>Lontra Ágil</div>
        <div style={{ fontSize: 40, marginTop: 20, opacity: 0.9 }}>
          Conecte-se com Desenvolvedores e Contratantes
        </div>
      </div>
    ),
    {
      ...size,
    }
  );
}
```

This creates a dynamic OG image at build time.

---

## Task 6: Add Favicon and Apple Touch Icon

### Files needed:

1. `/public/favicon.ico` - 32x32px or 16x16px ICO file
2. `/public/apple-touch-icon.png` - 180x180px PNG
3. `/public/site.webmanifest` - Web app manifest

**Web Manifest** (`/public/site.webmanifest`):

```json
{
  "name": "Lontra Ágil",
  "short_name": "Lontra Ágil",
  "description": "Plataforma que conecta desenvolvedores e contratantes",
  "icons": [
    {
      "src": "/lontra-icon.svg",
      "sizes": "any",
      "type": "image/svg+xml"
    },
    {
      "src": "/apple-touch-icon.png",
      "sizes": "180x180",
      "type": "image/png"
    }
  ],
  "theme_color": "#1e40af",
  "background_color": "#ffffff",
  "display": "standalone",
  "start_url": "/"
}
```

**Note**: You already have `/public/lontra-icon.svg`, which is good. Just need to create the other icons.

---

## Task 7: Update i18n Dictionaries

Add SEO-related translations to your dictionaries.

### File: `/src/i18n/locales/pt-br.json`

Add:
```json
{
  "seo": {
    "home": {
      "title": "Lontra Ágil - Conecte-se com Desenvolvedores e Contratantes",
      "description": "Plataforma que conecta desenvolvedores e contratantes para colaboração ágil em projetos."
    },
    "about": {
      "title": "Sobre Nós - Lontra Ágil",
      "description": "Conheça a Lontra Ágil e nossa missão de conectar desenvolvedores e contratantes."
    }
  }
}
```

### File: `/src/i18n/locales/en.json`

Add:
```json
{
  "seo": {
    "home": {
      "title": "Lontra Ágil - Connect with Developers and Contractors",
      "description": "Platform connecting developers and contractors for agile project collaboration."
    },
    "about": {
      "title": "About Us - Lontra Ágil",
      "description": "Learn about Lontra Ágil and our mission to connect developers and contractors."
    }
  }
}
```

---

## Testing & Validation

### 1. Build and Test Locally
```bash
npm run build
npm start
```

Visit:
- http://localhost:3000
- http://localhost:3000/app/auth/developer
- http://localhost:3000/app/auth/contractor
- http://localhost:3000/robots.txt

### 2. Validate Metadata

**View page source** and verify:
- `<title>` tag is correct
- `<meta name="description">` is present
- `<meta property="og:*">` tags are present
- `<meta name="twitter:*">` tags are present
- `<link rel="canonical">` is present
- `<script type="application/ld+json">` tags are present

### 3. Test with SEO Tools

**Google Rich Results Test**:
1. Go to: https://search.google.com/test/rich-results
2. Enter your local URL or deployed URL
3. Verify all schemas are valid

**Schema Validator**:
1. Go to: https://validator.schema.org/
2. Copy JSON-LD from page source
3. Paste and validate

**Facebook Sharing Debugger**:
1. Go to: https://developers.facebook.com/tools/debug/
2. Enter your URL (must be publicly accessible)
3. Verify OG image and metadata

**Twitter Card Validator**:
1. Go to: https://cards-dev.twitter.com/validator
2. Enter your URL (must be publicly accessible)
3. Verify Twitter Card preview

### 4. Lighthouse Audit

Run Lighthouse in Chrome DevTools:
```
1. Open Chrome DevTools
2. Go to "Lighthouse" tab
3. Select "SEO" category
4. Click "Analyze page load"
```

Target scores:
- SEO: 100/100
- Accessibility: 95+/100
- Best Practices: 90+/100

---

## Checklist

Before proceeding to Phase 3, ensure:

- [ ] Root layout updated with `generateRootMetadata()`
- [ ] Landing page has comprehensive metadata
- [ ] Landing page has Organization, WebSite, Breadcrumb, HowTo schemas
- [ ] Developer auth page has metadata (with noIndex)
- [ ] Contractor auth page has metadata (with noIndex)
- [ ] OG image created (`/public/og-image.png` or dynamic)
- [ ] Favicon and apple-touch-icon added
- [ ] site.webmanifest created
- [ ] i18n dictionaries updated with SEO translations
- [ ] All pages build without errors
- [ ] Schemas validated with validator.schema.org
- [ ] Google Rich Results Test passes
- [ ] Lighthouse SEO score is 100/100
- [ ] robots.txt is accessible at /robots.txt

---

## Common Issues & Solutions

### Issue: Metadata not appearing in page source
**Solution**: Ensure you're running a production build (`npm run build && npm start`). Development mode may not show all metadata.

### Issue: JSON-LD scripts appearing in wrong order
**Solution**: This is fine. Order doesn't matter for JSON-LD. Search engines will parse all scripts.

### Issue: Open Graph image not showing
**Solution**:
1. Verify image is at `/public/og-image.png`
2. Check image dimensions (1200x630px)
3. Ensure image size is < 300KB
4. Test with Facebook Debugger (must be publicly accessible)

### Issue: TypeScript errors with Metadata type
**Solution**: Ensure you're importing `Metadata` from `next`:
```typescript
import type { Metadata } from "next";
```

---

## Performance Notes

### ISR (Incremental Static Regeneration)

The landing page uses ISR with 24-hour revalidation:
```typescript
export const revalidate = 86400; // 24 hours
```

This means:
1. Page is statically generated at build time
2. Served from cache for 24 hours
3. After 24 hours, next request triggers regeneration
4. Subsequent requests get updated page

**Benefits**:
- Fast page loads (served from cache)
- SEO-friendly (bots see full HTML)
- Content stays fresh without rebuilding entire site

---

## Next Steps

Once Phase 2 is complete:
1. Proceed to [Phase 3: New Public Pages](./03-PHASE-3-NEW-PUBLIC-PAGES.md)
2. Test metadata on all enhanced pages
3. Monitor Google Search Console for any errors
4. Share preview links to verify social media previews
